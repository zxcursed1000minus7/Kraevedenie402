<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–æ—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f2f5;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
            height: calc(100vh - 40px);
            display: flex;
            flex-direction: column;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            flex-shrink: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }
        
        .header-content {
            flex: 1;
        }
        
        h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }
        
        .subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .header-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: flex-end;
        }
        
        .mode-toggle, .share-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 20px;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            white-space: nowrap;
            font-size: 14px;
        }
        
        .mode-toggle:hover, .share-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }
        
        .share-btn {
            background: rgba(52, 152, 219, 0.7);
        }
        
        .share-btn:hover {
            background: rgba(41, 128, 185, 0.7);
        }
        
        .main-content {
            display: flex;
            flex: 1;
            min-height: 0;
            transition: all 0.3s;
        }
        
        /* –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è */
        .edit-mode .main-content {
            display: flex;
        }
        
        .edit-mode .control-panel {
            display: block;
            width: 350px;
        }
        
        .edit-mode .map-container {
            flex: 1;
            position: relative;
        }
        
        .edit-mode #map {
            width: 100%;
            height: 100%;
        }
        
        .edit-mode .share-btn {
            display: flex;
        }
        
        /* –†–µ–∂–∏–º –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ */
        .presentation-mode .main-content {
            display: flex;
        }
        
        .presentation-mode .control-panel {
            display: none;
        }
        
        .presentation-mode .map-container {
            flex: 1;
            width: 100%;
        }
        
        .presentation-mode #map {
            width: 100%;
            height: 100%;
        }
        
        .presentation-mode .mode-toggle {
            background: rgba(255,255,255,0.3);
        }
        
        .presentation-mode .share-btn {
            display: none;
        }
        
        .presentation-mode .info-panel {
            display: flex !important;
        }
        
        /* –†–µ–∂–∏–º –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ —Å—Å—ã–ª–∫–µ (—Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä) */
        .presentation-only .header {
            display: none;
        }
        
        .presentation-only .main-content {
            height: 100%;
            display: flex;
        }
        
        .presentation-only .map-container {
            flex: 1;
            height: 100%;
            width: 100%;
            position: relative;
        }
        
        .presentation-only #map {
            height: 100%;
            width: 100%;
            border-radius: 15px;
        }
        
        .presentation-only .info-panel {
            display: flex !important;
        }
        
        .presentation-only .status-bar {
            display: none;
        }
        
        .map-container {
            flex: 1;
            position: relative;
            min-height: 0;
        }
        
        #map {
            width: 100%;
            height: 100%;
        }
        
        /* –ü–∞–Ω–µ–ª—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–æ—á–∫–µ */
        .info-panel {
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            width: 400px;
            background: white;
            box-shadow: -5px 0 20px rgba(0,0,0,0.1);
            border-left: 1px solid #ddd;
            z-index: 1000;
            display: none;
            flex-direction: column;
            overflow: hidden;
            transition: transform 0.3s ease;
        }
        
        .info-panel.active {
            display: flex;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
            }
            to {
                transform: translateX(0);
            }
        }
        
        .info-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            flex-shrink: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }
        
        .info-title {
            font-size: 1.5rem;
            margin: 0;
            padding-right: 40px; /* –ú–µ—Å—Ç–æ –¥–ª—è –∫—Ä–µ—Å—Ç–∏–∫–∞ */
        }
        
        .close-info-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.3s;
            z-index: 1001;
        }
        
        .close-info-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }
        
        .info-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        .info-description {
            margin-bottom: 25px;
            line-height: 1.6;
            color: #333;
            font-size: 15px;
        }
        
        .info-gallery {
            margin-bottom: 25px;
        }
        
        .info-gallery-title {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: #333;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .gallery-container {
            position: relative;
            width: 100%;
            margin-bottom: 10px;
        }
        
        .gallery-image {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 8px;
            display: block;
        }
        
        .gallery-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            transition: all 0.3s;
        }
        
        .gallery-nav:hover {
            background: rgba(0,0,0,0.7);
            transform: translateY(-50%) scale(1.1);
        }
        
        .gallery-prev {
            left: 10px;
        }
        
        .gallery-next {
            right: 10px;
        }
        
        .gallery-counter {
            text-align: center;
            margin-bottom: 15px;
            font-size: 14px;
            color: #666;
        }
        
        .gallery-thumbnails {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 5px 0;
        }
        
        .gallery-thumb {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
            cursor: pointer;
            opacity: 0.6;
            transition: all 0.3s;
            flex-shrink: 0;
        }
        
        .gallery-thumb.active {
            opacity: 1;
            border: 2px solid #667eea;
        }
        
        .gallery-thumb:hover {
            opacity: 0.8;
        }
        
        .info-audio {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .info-audio-title {
            font-size: 1.1rem;
            margin-bottom: 15px;
            color: #333;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .audio-player {
            width: 100%;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
        }
        
        .audio-player audio {
            width: 100%;
        }
        
        /* –£–±—Ä–∞–ª —Ñ—É—Ç–µ—Ä —Å –¥–∞—Ç–æ–π */
        
        .control-panel {
            width: 350px;
            background: #f8f9fa;
            padding: 15px;
            border-left: 1px solid #ddd;
            overflow-y: auto;
            flex-shrink: 0;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
            font-size: 14px;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        textarea {
            height: 80px;
            resize: vertical;
        }
        
        .file-input-group {
            margin-bottom: 8px;
        }
        
        .file-input-container {
            position: relative;
            margin-bottom: 5px;
        }
        
        .file-input-label {
            display: block;
            background: #f8f9fa;
            border: 2px dashed #667eea;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .file-input-label:hover {
            background: #e9ecef;
            border-color: #5a67d8;
        }
        
        .file-input-label i {
            font-size: 24px;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .file-input-label span {
            display: block;
            font-size: 14px;
            color: #666;
        }
        
        .file-input-label small {
            display: block;
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }
        
        .file-input {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            opacity: 0;
            cursor: pointer;
        }
        
        .photos-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 5px;
            max-height: 150px;
            overflow-y: auto;
            padding: 5px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .photo-preview-item {
            position: relative;
            width: 60px;
            height: 60px;
            border-radius: 3px;
            overflow: hidden;
            border: 1px solid #ddd;
        }
        
        .photo-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .remove-photo {
            position: absolute;
            top: 2px;
            right: 2px;
            background: rgba(231, 76, 60, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            font-size: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .audio-preview {
            margin-top: 5px;
            padding: 10px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .audio-preview audio {
            flex: 1;
            height: 30px;
        }
        
        .remove-audio {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
        }
        
        .file-info {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        
        .button-group {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }
        
        button {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .btn-primary {
            background: #667eea;
            color: white;
            flex: 2;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
            flex: 1;
        }
        
        .btn-primary:hover {
            background: #5a67d8;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .locations-list {
            margin-top: 15px;
            border-top: 1px solid #ddd;
            padding-top: 15px;
        }
        
        .location-item {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .location-item:hover {
            border-color: #667eea;
            transform: translateX(3px);
        }
        
        .location-item.active {
            border-color: #667eea;
            background: #f0f7ff;
        }
        
        .location-item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 3px;
        }
        
        .location-title {
            font-weight: 600;
            color: #333;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .location-photos-count {
            background: #667eea;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .status-bar {
            padding: 8px 15px;
            background: #e9ecef;
            text-align: center;
            font-size: 13px;
            color: #666;
            border-top: 1px solid #ddd;
            flex-shrink: 0;
            transition: all 0.3s;
        }
        
        .presentation-mode .status-bar {
            display: none;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å—Å—ã–ª–∫–∏ */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal {
            background: white;
            border-radius: 10px;
            padding: 25px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        
        .modal h2 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.5rem;
        }
        
        .modal p {
            margin-bottom: 20px;
            color: #666;
            line-height: 1.5;
        }
        
        .link-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .link-input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background: #f8f9fa;
        }
        
        .copy-btn {
            background: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .copy-btn:hover {
            background: #218838;
        }
        
        .copy-btn.copied {
            background: #6c757d;
        }
        
        .qr-code {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        .close-modal {
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 10px 20px;
            cursor: pointer;
        }
        
        .close-modal:hover {
            background: #5a6268;
        }
        
        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */
        .upload-progress {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px 30px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 10001;
            text-align: center;
        }
        
        .upload-progress.active {
            display: block;
        }
        
        .progress-bar {
            width: 200px;
            height: 10px;
            background: #f0f0f0;
            border-radius: 5px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s;
        }
        
        /* –ö–Ω–æ–ø–∫–∞ "–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é" –¥–ª—è —Ä–µ–∂–∏–º–∞ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ */
        .show-info-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            background: rgba(255,255,255,0.9);
            color: #333;
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s;
            display: none;
        }
        
        .show-info-btn:hover {
            background: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .presentation-only .show-info-btn,
        .presentation-mode .show-info-btn {
            display: block;
        }
        
        .info-hidden .info-panel {
            display: none !important;
        }
        
        .info-hidden .show-info-btn i {
            transform: rotate(180deg);
        }
        
        @media (max-width: 1200px) {
            .info-panel {
                width: 350px;
            }
            
            .gallery-image {
                height: 250px;
            }
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                height: calc(100vh - 20px);
            }
            
            header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .header-buttons {
                width: 100%;
                justify-content: space-between;
            }
            
            .mode-toggle, .share-btn {
                flex: 1;
                justify-content: center;
            }
            
            .main-content {
                flex-direction: column;
            }
            
            .edit-mode .control-panel {
                width: 100%;
                border-left: none;
                border-top: 1px solid #ddd;
                max-height: 400px;
            }
            
            .edit-mode .map-container {
                min-height: 400px;
            }
            
            .info-panel {
                width: 100%;
                height: 60vh;
                bottom: 0;
                top: auto;
                border-left: none;
                border-top: 1px solid #ddd;
            }
            
            .gallery-image {
                height: 200px;
            }
            
            .show-info-btn {
                top: 5px;
                right: 5px;
                font-size: 12px;
                padding: 6px 12px;
            }
            
            h1 {
                font-size: 1.5rem;
            }
        }
        
        @media (max-width: 480px) {
            .header-buttons {
                flex-direction: column;
                gap: 8px;
            }
            
            .mode-toggle, .share-btn {
                width: 100%;
            }
            
            .file-input-label {
                padding: 15px;
            }
            
            .photos-preview {
                max-height: 120px;
            }
            
            .photo-preview-item {
                width: 50px;
                height: 50px;
            }
            
            .gallery-image {
                height: 180px;
            }
            
            .info-title {
                font-size: 1.3rem;
            }
            
            .show-info-btn {
                font-size: 11px;
                padding: 5px 10px;
            }
        }
        
        /* –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –∞—Ç—Ä–∏–±—É—Ü–∏–∏ Leaflet */
        .leaflet-control-attribution {
            display: none !important;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–π –∏–∫–æ–Ω–∫–∏ */
        .custom-div-icon {
            background: transparent !important;
            border: none !important;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤ */
        .container {
            transition: all 0.3s ease;
        }
        
        /* –°—Ç–∏–ª—å –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" –≤ —Ä–µ–∂–∏–º–µ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ —Å—Å—ã–ª–∫–µ */
        .back-button {
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1000;
            background: rgba(255,255,255,0.9);
            color: #333;
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        
        .back-button:hover {
            background: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .presentation-only .back-button {
            display: block;
        }
    </style>
</head>
<body>
    <!-- –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –¥–ª—è —Ä–µ–∂–∏–º–∞ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ —Å—Å—ã–ª–∫–µ -->
    <button class="back-button" id="backButton" style="display: none;">
        <i class="fas fa-arrow-left"></i> –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
    </button>
    
    <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–æ–∫–∞–∑–∞/—Å–∫—Ä—ã—Ç–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ —Ä–µ–∂–∏–º–µ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ -->
    <button class="show-info-btn" id="showInfoBtn">
        <i class="fas fa-chevron-left"></i> –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
    </button>
    
    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ -->
    <div class="upload-progress" id="uploadProgress">
        <div class="spinner">
            <i class="fas fa-spinner fa-spin fa-2x" style="color: #667eea;"></i>
        </div>
        <div id="uploadText">–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤...</div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div id="uploadCount">0 –∏–∑ 0 —Ñ–∞–π–ª–æ–≤</div>
    </div>
    
    <div class="container edit-mode" id="mainContainer">
        <header>
            <div class="header-content">
                <h1><i class="fas fa-map-marked-alt"></i> –ú–æ—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞</h1>
                <p class="subtitle" id="modeSubtitle">–†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: –¥–æ–±–∞–≤–ª—è–π—Ç–µ –Ω–æ–≤—ã–µ –º–µ—Å—Ç–∞</p>
            </div>
            <div class="header-buttons">
                <button class="share-btn" id="shareBtn">
                    <i class="fas fa-share-alt"></i> –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
                </button>
                <button class="mode-toggle" id="modeToggle">
                    <i class="fas fa-tv"></i> –†–µ–∂–∏–º –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏
                </button>
            </div>
        </header>
        
        <div class="main-content">
            <div class="map-container">
                <div id="map"></div>
                
                <!-- –ü–∞–Ω–µ–ª—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–æ—á–∫–µ -->
                <div class="info-panel" id="infoPanel">
                    <div class="info-header">
                        <div class="info-title" id="infoTitle">–ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞</div>
                        <button class="close-info-btn" id="closeInfoPanel">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="info-content" id="infoContent">
                        <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
            </div>
            
            <div class="control-panel">
                <div class="form-group">
                    <label for="locationName">–ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞:</label>
                    <input type="text" id="locationName" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
                </div>
                
                <div class="form-group">
                    <label for="latitude">–®–∏—Ä–æ—Ç–∞:</label>
                    <input type="number" id="latitude" step="any" placeholder="55.7558">
                </div>
                
                <div class="form-group">
                    <label for="longitude">–î–æ–ª–≥–æ—Ç–∞:</label>
                    <input type="number" id="longitude" step="any" placeholder="37.6173">
                </div>
                
                <div class="form-group">
                    <label for="description">–û–ø–∏—Å–∞–Ω–∏–µ:</label>
                    <textarea id="description" placeholder="–û–ø–∏—à–∏—Ç–µ —ç—Ç–æ –º–µ—Å—Ç–æ"></textarea>
                </div>
                
                <div class="form-group">
                    <label>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏:</label>
                    <div class="file-input-group">
                        <div class="file-input-container">
                            <label class="file-input-label" for="photoUpload">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <span>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ</span>
                                <small>–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª—ã (JPG, PNG)</small>
                            </label>
                            <input type="file" id="photoUpload" class="file-input" accept="image/*" multiple>
                        </div>
                        <div class="file-info">
                            –ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–æ—Ç–æ (–º–∞–∫—Å. 10 —Ñ–∞–π–ª–æ–≤ –ø–æ 5 –ú–ë)
                        </div>
                    </div>
                    <div class="photos-preview" id="photosPreview">
                        <!-- –ü—Ä–µ–≤—å—é —Ñ–æ—Ç–æ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label>–ê—É–¥–∏–æ—Ñ–∞–π–ª:</label>
                    <div class="file-input-group">
                        <div class="file-input-container">
                            <label class="file-input-label" for="audioUpload" style="padding: 15px;">
                                <i class="fas fa-file-audio"></i>
                                <span>–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∞—É–¥–∏–æ</span>
                                <small>MP3, WAV, OGG (–º–∞–∫—Å. 10 –ú–ë)</small>
                            </label>
                            <input type="file" id="audioUpload" class="file-input" accept="audio/*">
                        </div>
                    </div>
                    <div class="audio-preview" id="audioPreview" style="display: none;">
                        <!-- –ü—Ä–µ–≤—å—é –∞—É–¥–∏–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="markerColor">–¶–≤–µ—Ç –º–∞—Ä–∫–µ—Ä–∞:</label>
                    <select id="markerColor">
                        <option value="#e74c3c">–ö—Ä–∞—Å–Ω—ã–π</option>
                        <option value="#3498db" selected>–°–∏–Ω–∏–π</option>
                        <option value="#2ecc71">–ó–µ–ª–µ–Ω—ã–π</option>
                        <option value="#f39c12">–û—Ä–∞–Ω–∂–µ–≤—ã–π</option>
                        <option value="#9b59b6">–§–∏–æ–ª–µ—Ç–æ–≤—ã–π</option>
                        <option value="#1abc9c">–ë–∏—Ä—é–∑–æ–≤—ã–π</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="markerIcon">–ò–∫–æ–Ω–∫–∞ –º–∞—Ä–∫–µ—Ä–∞:</label>
                    <select id="markerIcon">
                        <option value="fa-map-marker-alt" selected>üìç –ú–µ—Ç–∫–∞</option>
                        <option value="fa-landmark">üèõÔ∏è –ü–∞–º—è—Ç–Ω–∏–∫</option>
                        <option value="fa-tree">üå≥ –ü—Ä–∏—Ä–æ–¥–∞</option>
                        <option value="fa-building">üè¢ –ó–¥–∞–Ω–∏–µ</option>
                        <option value="fa-utensils">üçΩÔ∏è –†–µ—Å—Ç–æ—Ä–∞–Ω</option>
                        <option value="fa-bed">üè® –û—Ç–µ–ª—å</option>
                        <option value="fa-museum">üèõÔ∏è –ú—É–∑–µ–π</option>
                        <option value="fa-church">‚õ™ –¶–µ—Ä–∫–æ–≤—å</option>
                        <option value="fa-park">üåø –ü–∞—Ä–∫</option>
                        <option value="fa-camera">üì∑ –§–æ—Ç–æ-—Ç–æ—á–∫–∞</option>
                    </select>
                </div>
                
                <div class="button-group">
                    <button class="btn-primary" onclick="addLocation()">
                        <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –º–µ—Å—Ç–æ
                    </button>
                    <button class="btn-secondary" onclick="clearForm()">
                        <i class="fas fa-eraser"></i> –û—á–∏—Å—Ç–∏—Ç—å
                    </button>
                </div>
                
                <div class="locations-list" id="locationsList">
                    <h3 style="font-size: 16px; margin-bottom: 10px;">–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –º–µ—Å—Ç–∞ (0)</h3>
                    <!-- –°–ø–∏—Å–æ–∫ –º–µ—Å—Ç –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
                </div>
            </div>
        </div>
        
        <div class="status-bar" id="statusBar">
            –ö–∞—Ä—Ç–∞ –≥–æ—Ç–æ–≤–∞. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç.
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å—Å—ã–ª–∫–∏ -->
    <div class="modal-overlay" id="shareModal">
        <div class="modal">
            <h2><i class="fas fa-share-alt"></i> –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∫–∞—Ä—Ç–æ–π</h2>
            <p>–°–æ–∑–¥–∞–π—Ç–µ —Å—Å—ã–ª–∫—É –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∫–∞—Ä—Ç—ã –≤ —Ä–µ–∂–∏–º–µ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏. –≠—Ç—É —Å—Å—ã–ª–∫—É –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–º –ª—é–¥—è–º.</p>
            
            <div class="link-container">
                <input type="text" readonly class="link-input" id="presentationLink">
                <button class="copy-btn" id="copyLinkBtn">
                    <i class="far fa-copy"></i> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å
                </button>
            </div>
            
            <div class="qr-code" id="qrCode">
                <!-- QR-–∫–æ–¥ –±—É–¥–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∑–¥–µ—Å—å -->
                <p style="color: #666; font-size: 14px;">QR-–∫–æ–¥ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤</p>
                <canvas id="qrCanvas" width="200" height="200"></canvas>
            </div>
            
            <div class="modal-buttons">
                <button class="close-modal" id="closeModal">
                    –ó–∞–∫—Ä—ã—Ç—å
                </button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è QR-–∫–æ–¥–∞ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
        <script>
    // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–æ —Ñ—É–Ω–∫—Ü–∏–∏ saveMapData() ...

    // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç—ã –≤ localStorage
    function saveMapData() {
        // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        const mapData = {
            id: mapId,
            locations: locations.map(location => ({
                id: location.id,
                name: location.name,
                lat: location.lat,
                lng: location.lng,
                description: location.description,
                photos: location.photos,
                audioUrl: location.audioUrl,
                color: location.color,
                icon: location.icon
            })),
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
        };
        
        try {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
            localStorage.setItem('interactive_map_' + mapId, JSON.stringify(mapData));
            
            // –î—É–±–ª–∏—Ä—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–¥ –æ–±—â–∏–º –∫–ª—é—á–æ–º –¥–ª—è –ø–æ—Å–ª–µ–¥–Ω–µ–π –∫–∞—Ä—Ç—ã
            localStorage.setItem('interactive_map_last_id', mapId);
            
            console.log('üíæ –ö–∞—Ä—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞:', mapId, '–ú–µ—Å—Ç:', locations.length);
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
            return mapData;
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage:', error);
            return null;
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç—ã –∏–∑ localStorage
    function loadMapData(id) {
        try {
            console.log('üîç –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ä—Ç—É —Å ID:', id);
            
            const data = localStorage.getItem('interactive_map_' + id);
            if (data) {
                console.log('üìÇ –ù–∞–π–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –≤ localStorage');
                const mapData = JSON.parse(data);
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º locations
                locations = mapData.locations || [];
                console.log('üìç –ó–∞–≥—Ä—É–∂–µ–Ω–æ –º–µ—Å—Ç:', locations.length);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π mapId
                mapId = id;
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞—Ä–∫–µ—Ä—ã –Ω–∞ –∫–∞—Ä—Ç–µ
                restoreMarkers();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –º–µ—Å—Ç (–µ—Å–ª–∏ –º—ã –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
                if (!document.body.classList.contains('presentation-only')) {
                    updateLocationsList();
                }
                
                console.log('‚úÖ –ö–∞—Ä—Ç–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞:', id);
                return true;
            } else {
                console.warn('‚ùå –î–∞–Ω–Ω—ã–µ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –¥–ª—è ID:', id);
                
                // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –∫–∞—Ä—Ç—É
                const lastId = localStorage.getItem('interactive_map_last_id');
                if (lastId && lastId !== id) {
                    console.log('üîÑ –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –∫–∞—Ä—Ç—É:', lastId);
                    return loadMapData(lastId);
                }
                
                return false;
            }
        } catch (e) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã:', e);
            return false;
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Å—ã–ª–∫–∏ –¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏
    function generatePresentationLink() {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã –≤ localStorage
        const savedData = saveMapData();
        
        if (!savedData) {
            alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–∞—Ä—Ç—ã. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞.');
            return '';
        }
        
        console.log('üîó –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è –∫–∞—Ä—Ç—ã:', mapId);
        
        // –ï—Å–ª–∏ —Ñ–∞–π–ª –∑–∞–ø—É—â–µ–Ω –ª–æ–∫–∞–ª—å–Ω–æ, —Å–æ–∑–¥–∞–µ–º –æ—Å–æ–±—É—é —Å—Å—ã–ª–∫—É
        if (isLocalFile) {
            const fileName = window.location.pathname.split('/').pop() || '–∫–∞—Ä—Ç–∞.html';
            return `–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª ${fileName}?mode=presentation&id=${mapId} –ª–æ–∫–∞–ª—å–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ`;
        }
        
        // –î–ª—è –≤–µ–±-–≤–µ—Ä—Å–∏–∏ —Å–æ–∑–¥–∞–µ–º –ø–æ–ª–Ω—É—é —Å—Å—ã–ª–∫—É
        let baseUrl = window.location.origin + window.location.pathname;
        
        // –£–±–∏—Ä–∞–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ –¥—É–±–ª–∏—Ä—É—é—â–∏–µ —Å–ª–µ—à–∏
        baseUrl = baseUrl.replace(/([^:]\/)\/+/g, "$1");
        
        // –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
        baseUrl = baseUrl.split('?')[0];
        baseUrl = baseUrl.split('#')[0];
        
        const presentationUrl = `${baseUrl}?mode=presentation&id=${mapId}`;
        
        console.log('üìã –°—Å—ã–ª–∫–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞:', presentationUrl);
        return presentationUrl;
    }
    
    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ URL –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    function checkUrlParams() {
        try {
            const urlParams = new URLSearchParams(window.location.search);
            const mode = urlParams.get('mode');
            const id = urlParams.get('id');
            
            console.log('üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã URL:', { mode, id });
            
            if (mode === 'presentation' && id) {
                // –†–µ–∂–∏–º –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ —Å—Å—ã–ª–∫–µ
                console.log('üé¨ –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –¥–ª—è –∫–∞—Ä—Ç—ã:', id);
                
                // –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –∫–∞—Ä—Ç—ã
                setTimeout(() => {
                    if (loadMapData(id)) {
                        console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã');
                        mapId = id;
                        
                        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
                        document.body.classList.add('presentation-only');
                        const mainContainer = document.getElementById('mainContainer');
                        if (mainContainer) {
                            mainContainer.classList.add('presentation-mode');
                        }
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
                        const backButton = document.getElementById('backButton');
                        if (backButton) {
                            backButton.style.display = 'block';
                        }
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
                        const showInfoBtn = document.getElementById('showInfoBtn');
                        if (showInfoBtn) {
                            showInfoBtn.style.display = 'block';
                        }
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Ä–∞–∑–º–µ—Ä –∫–∞—Ä—Ç—ã
                        setTimeout(() => {
                            map.invalidateSize();
                        }, 100);
                        
                        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—É—é —Ç–æ—á–∫—É
                        if (locations.length > 0) {
                            console.log('üìç –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—É—é —Ç–æ—á–∫—É –∏–∑', locations.length);
                            showLocationInfo(locations[0]);
                            map.setView([locations[0].lat, locations[0].lng], 13);
                        } else {
                            console.warn('üìç –ù–µ—Ç —Ç–æ—á–µ–∫ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è');
                            // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –Ω–∞ –ú–æ—Å–∫–≤–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                            map.setView([55.7558, 37.6173], 13);
                        }
                        
                        console.log('üéâ –†–µ–∂–∏–º –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –¥–ª—è –∫–∞—Ä—Ç—ã:', id);
                    } else {
                        console.error('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∫–∞—Ä—Ç—É:', id);
                        alert('–ö–∞—Ä—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –í–æ–∑–º–æ–∂–Ω–æ, —Å—Å—ã–ª–∫–∞ —É—Å—Ç–∞—Ä–µ–ª–∞ –∏–ª–∏ –¥–∞–Ω–Ω—ã–µ –±—ã–ª–∏ –æ—á–∏—â–µ–Ω—ã.\n\n–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –∫–∞—Ä—Ç—É –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—ã —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏ —Ç–æ—á–∫–∏ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º —Å—Å—ã–ª–∫–∏.');
                        
                        // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ –æ—Å–Ω–æ–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
                        setTimeout(() => {
                            window.location.href = window.location.pathname;
                        }, 2000);
                    }
                }, 100);
            } else if (mode === 'presentation' && !id) {
                // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∫–∞—Ä—Ç—É –¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏
                console.log('üÜï –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ä—Ç—ã –¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏');
                mapId = generateMapId();
                saveMapData();
                
                const newUrl = window.location.origin + window.location.pathname + 
                              '?mode=presentation&id=' + mapId;
                console.log('üîÑ –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞:', newUrl);
                window.location.href = newUrl;
            } else if (id && !mode) {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∫–∞—Ä—Ç—É –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                console.log('‚úèÔ∏è –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:', id);
                if (loadMapData(id)) {
                    console.log('‚úÖ –ö–∞—Ä—Ç–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
                    updateStatus(`–ö–∞—Ä—Ç–∞ "${mapId}" –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –î–æ–±–∞–≤–ª–µ–Ω–æ ${locations.length} –º–µ—Å—Ç.`);
                } else {
                    console.warn('‚ö†Ô∏è –ö–∞—Ä—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é');
                    saveMapData();
                }
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –≤ checkUrlParams:', error);
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è "–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é" –¥–ª—è —Ä–µ–∂–∏–º–∞ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ —Å—Å—ã–ª–∫–µ
    function goToEditMode() {
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º
        saveMapData();
        
        // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        const editUrl = window.location.origin + window.location.pathname + 
                      '?id=' + mapId;
        console.log('üîÑ –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:', editUrl);
        window.location.href = editUrl;
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    function init() {
        console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã...');
        
        // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã URL
        checkUrlParams();
        
        // –ï—Å–ª–∏ —ç—Ç–æ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–Ω–µ –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Å—Å—ã–ª–∫–µ)
        if (!document.body.classList.contains('presentation-only')) {
            console.log('‚úèÔ∏è –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
            
            // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –Ω–∞–∑–≤–∞–Ω–∏—è
            const locationName = document.getElementById('locationName');
            if (locationName) {
                locationName.focus();
            }
            
            // –ï—Å–ª–∏ –Ω–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ id, —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∫–∞—Ä—Ç—É
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');
            
            if (!id) {
                console.log('üÜï –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ä—Ç—ã');
                saveMapData();
            }
            
            updateStatus('–ö–∞—Ä—Ç–∞ –≥–æ—Ç–æ–≤–∞. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–∞—Ä—Ç—É, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã.');
        }
        
        // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å init() –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ...
    }
    
    // –ó–∞–ø—É—Å–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    init();
    
    // –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª–∏
    window.addLocation = addLocation;
    window.clearForm = clearForm;
    window.locations = locations;
    window.markers = markers;
    window.prevGalleryImage = prevGalleryImage;
    window.nextGalleryImage = nextGalleryImage;
    window.showGalleryImage = showGalleryImage;
    window.toggleMode = toggleMode;
    window.toggleInfoPanel = toggleInfoPanel;
    window.closeInfoPanel = closeInfoPanel;
    window.generatePresentationLink = generatePresentationLink;
    window.saveMapData = saveMapData;
    window.loadMapData = loadMapData;
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ - –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã
    window.showAllSavedMaps = function() {
        console.log('üìä –í—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∫–∞—Ä—Ç—ã –≤ localStorage:');
        for (let i = 0; i < localStorage.length; i++) {
            const key = localStorage.key(i);
            if (key.startsWith('interactive_map_')) {
                console.log(key);
                try {
                    const data = JSON.parse(localStorage.getItem(key));
                    console.log(data);
                } catch(e) {
                    console.log('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞:', key);
                }
            }
        }
    };
    
    console.log('‚úÖ –ö–∞—Ä—Ç–∞ –≥–æ—Ç–æ–≤–∞!');
    console.log('üåê –†–µ–∂–∏–º:', isLocalFile ? '–õ–æ–∫–∞–ª—å–Ω—ã–π (file://)' : '–í–µ–±-—Å–µ—Ä–≤–µ—Ä (http/https)');
    console.log('üîó ID –∫–∞—Ä—Ç—ã:', mapId);
    console.log('üìç –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ç–æ—á–µ–∫:', locations.length);
    console.log('üíæ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ showAllSavedMaps() –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏');
</script>
</body>
</html>